---

interface Props {
  background_color?: string;
  content: {
    heading_text?: string;
    subtitle_text?: string;
  };
  stanford_section: {
    background_image: string;
    logo_path: string;
    logo_alt: string;
    description: string;
    team_members: Array<{
      name: string;
      title: string;
      link: string;
      image_path: string;
      image_alt: string;
    }>
  };
  consumer_reports_section: {
    background_image: string;
    overlay_color: string;
    logo_path: string;
    logo_alt: string;
    description: string;
    team_members: Array<{
      name: string;
      title: string;
      link: string;
      image_path: string;
      image_alt: string;
    }>
  };
  team_members: Array<{
    name: string;
    title: string;
    link: string;
    image_path: string;
    image_alt: string;
  }>;
  partners: {
    title: string;
    partner_logos: Array<{
      name: string;
      image_path: string;
      image_alt: string;
    }>;
  };
}

const { background_color = "#ffffff", content, stanford_section, consumer_reports_section, team_members, partners } = Astro.props;

// Helper function to get dynamic grid classes based on number of team members
function getGridClasses(memberCount: number): string {
  if (memberCount <= 4) {
    // 1-5 people: each gets their own column
    return `grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8`;
  } else if (memberCount === 5) {
    // 6 people: strict 3-column grid
    return `grid grid-cols-2 md:grid-cols-5 gap-8`;
  } else if (memberCount === 6) {
    // 6 people: strict 3-column grid
    return `grid grid-cols-2 md:grid-cols-3 gap-8`;
  } else {
    // 8+ people: strict 4-column grid
    return `grid grid-cols-2 md:grid-cols-4 gap-8`;
  }
}
---

<section
  id="who-we-are"
  class="relative bg-white py-20 overflow-hidden"
  style={`background-color: ${background_color};`}
  aria-labelledby="who-we-are-heading"
>
  <!-- Vertical Grid Lines -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="max-w-7xl mx-auto h-full relative">
      <div class="absolute h-full w-px border-gray-200 border-dashed border-l-1 left-0"></div>
      <div class="absolute h-full w-px border-gray-200 border-dashed border-l-1 left-1/3"></div>
      <div class="absolute h-full w-px border-gray-200 border-dashed border-l-1 left-2/3"></div>
      <div class="absolute h-full w-px border-gray-200 border-dashed border-l-1 right-0"></div>
    </div>
  </div>

  <!-- Content Container -->
  <div class="relative z-10 max-w-7xl mx-auto px-8">

    <!-- Header Section -->
    <div class="lg:text-center mb-16">
      <h2
        id="who-we-are-heading"
        class="font-sans text-5xl md:text-6xl font-medium text-black tracking-tight mb-6"
      >
        {content.heading_text}
      </h2>
      <p class="max-w-4xl font-sans text-xl text-black leading-loose mx-auto">
        {content.subtitle_text}
      </p>
    </div>

    <!-- Stanford Section -->
    <div class="bg-blue-900 rounded-lg overflow-hidden mb-8 relative">
      <div
        class="absolute inset-0 bg-cover bg-center bg-no-repeat"
        style={`background-image: url('${stanford_section.background_image}');`}
      >
      </div>
      <div class="relative z-10 h-full flex items-center px-12 py-12">
        <div class="flex items-start lg:items-center flex-col lg:flex-row gap-8">
          <img
            src={stanford_section.logo_path}
            alt={stanford_section.logo_alt}
            class="h-16 object-contain lg:mr-20"
          />
          <p class="font-sans text-xl text-white">
            {stanford_section.description}
          </p>
        </div>
      </div>
    </div>

    <!-- Team Members Section - First Row -->
    <div class={`${getGridClasses(stanford_section.team_members.length)} mb-20`}>
       {stanford_section.team_members.map((member) => (
        member.link ? (
          <a href={member.link} class="lg:text-center" target="_blank" rel="noopener noreferrer group">
            <div class="bg-[#f0f0f0] rounded-lg max-h-lg max-w-lg aspect-square mb-6 overflow-hidden">
              <img
                src={member.image_path}
                alt={member.image_alt}
                class="w-full h-full object-cover"
              />
            </div>
            <h3 class="font-sans text-xl leading-tight font-medium text-black mb-2 group-hover:!text-primary transition-all">
              {member.name}
            </h3>
            <p class="font-sans text-lg text-black leading-tight group-hover:!text-primary transition-all">
              {member.title}
            </p>
          </a>
        ) : (
          <div class="lg:text-center">
            <div class="bg-[#f0f0f0] rounded-lg max-h-lg max-w-lg aspect-square mb-6 overflow-hidden">
              <img
                src={member.image_path}
                alt={member.image_alt}
                class="w-full h-full object-cover"
              />
            </div>
            <h3 class="font-sans text-xl leading-tight font-medium text-black mb-2">
              {member.name}
            </h3>
            <p class="font-sans text-lg text-black leading-tight">
              {member.title}
            </p>
          </div>
        )
      ))}
    </div>

    <!-- Consumer Reports Section -->
    <div class="bg-green-900 rounded-lg overflow-hidden mb-8 relative">
      <div
        class="absolute inset-0 bg-cover bg-center bg-no-repeat"
        style={`background-image: url('${consumer_reports_section.background_image}');`}
      >
      </div>
      <div
        class="absolute inset-0 mix-blend-multiply opacity-50"
        style={`background-color: ${consumer_reports_section.overlay_color};`}
      ></div>
      <div class="relative z-10 h-full flex items-center justify-between px-12 py-12">
        <div class="flex items-start lg:items-center flex-col lg:flex-row gap-8">
          <img
            src={consumer_reports_section.logo_path}
            alt={consumer_reports_section.logo_alt}
            class="h-16 object-contain lg:mr-20"
          />
          <p class="font-sans text-xl text-white">
            {consumer_reports_section.description}
          </p>


        </div>

      </div>
    </div>

    <!-- Team Members Section - Second Row -->
    <div class={`${getGridClasses(consumer_reports_section.team_members.length)} mb-20`}>
      {consumer_reports_section.team_members.map((member) => (
        member.link ? (
          <a href={member.link} class="lg:text-center" target="_blank" rel="noopener noreferrer">
            <div class="bg-[#f0f0f0] rounded-lg max-h-lg max-w-lg aspect-square mb-6 overflow-hidden">
              <img
                src={member.image_path}
                alt={member.image_alt}
                class="w-full h-full object-cover"
              />
            </div>
            <h3 class="font-sans text-xl leading-tight font-medium text-black mb-2">
              {member.name}
            </h3>
            <p class="font-sans text-lg text-black leading-tight">
              {member.title}
            </p>
          </a>
        ) : (
          <div class="lg:text-center">
            <div class="bg-[#f0f0f0] rounded-lg max-h-lg max-w-lg aspect-square mb-6 overflow-hidden">
              <img
                src={member.image_path}
                alt={member.image_alt}
                class="w-full h-full object-cover"
              />
            </div>
            <h3 class="font-sans text-xl leading-tight font-medium text-black mb-2">
              {member.name}
            </h3>
            <p class="font-sans text-lg text-black leading-tight">
              {member.title}
            </p>
          </div>
        )
      ))}
    </div>

    <!-- Partners Section -->
    <div class="text-center">
      <h3 class="font-sans text-4xl font-medium text-black mb-12">
        {partners.title}
      </h3>

      <!-- Partner Logos -->
      <div class="grid grid-cols-2 md:grid-cols-3 gap-8 md:gap-4 md:gap-y-16 w-full">
        {partners.partner_logos.map((partner) => (
          <div class="flex-shrink-0 flex items-center justify-center">
            <img
              src={partner.image_path}
              alt={partner.image_alt}
              class="h-[100px] lg:h-[130px] w-auto object-contain"
            />
          </div>
        ))}
      </div>
    </div>

  </div>
</section>
